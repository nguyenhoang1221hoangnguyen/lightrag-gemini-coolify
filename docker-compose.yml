version: '3.8'

services:
  lightrag:
    image: lightrag/lightrag:latest # Hoặc build từ Dockerfile
    restart: unless-stopped
    environment:
      - EMBEDDING_DIM=${EMBEDDING_DIM:-768}
      - EMBEDDING_MODEL=${EMBEDDING_MODEL:-text-embedding-004}
      - LLM_MODEL=${LLM_MODEL:-gemini-1.5-pro}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - SERVICE_FQDN_LIGHTRAG_9621 # Coolify magic variable
    ports:
      - "9621:9621"
    volumes:
      - lightrag-data:/app/rag_storage
      - lightrag-inputs:/app/data/inputs
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:9621/health" ]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  lightrag-data:
  lightrag-inputs:
